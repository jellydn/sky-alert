# Ralph Progress Log
Started: Thu Feb 19 11:09:23 +08 2026
---

## Thu Feb 19 11:12:34 +08 2026 - US-001
- Initialized TypeScript project with grammy, drizzle-orm, and better-sqlite3
- Created database schema with three tables: flights, tracked_flights, status_changes
- Set up Drizzle ORM configuration and generated migrations
- Database migrations run successfully with all tables created
- Typecheck passes
- Files changed: package.json, tsconfig.json, drizzle.config.ts, src/db/schema.ts, src/db/index.ts, src/index.ts, .env.example, .gitignore
**Learnings for future iterations:**
- Drizzle Kit uses "dialect: 'sqlite'" instead of "driver" in config
- Migrations are generated in drizzle/ directory and should be committed
- SQLite database file is created in data/ directory on first migration
---

## Thu Feb 19 11:15:42 +08 2026 - US-002
- Set up Telegram bot using grammY framework
- Implemented /start command with welcome message
- Implemented /help command with list of available commands
- Bot connects to Telegram using BOT_TOKEN env variable
- Bot uses long polling (default grammY behavior)
- Typecheck passes
- Files changed: src/bot/index.ts, src/index.ts
**Learnings for future iterations:**
- grammY's auto-quote middleware package doesn't exist or has different name - skip for now
- Bot needs to be started after database connection is verified
- grammY uses ctx.reply() with parse_mode for formatted messages
---

## Thu Feb 19 11:18:52 +08 2026 - US-003
- Created Aviationstack API service with flight lookup functionality
- Implemented flight service with database operations (create, get, track, untrack)
- Created /track command handler that parses flight number and date
- Bot validates flight existence via Aviationstack API
- If valid, saves flight to flights table and links to chat_id in tracked_flights
- Bot replies with confirmation showing flight number, route, and times
- Error handling for flight not found, rate limits, and API errors
- Typecheck passes
- Files changed: src/services/aviationstack.ts, src/services/flight-service.ts, src/handlers/track.ts, src/bot/index.ts
**Learnings for future iterations:**
- Aviationstack API requires access_key query parameter
- Use `as Type` casting for API responses when TypeScript can't infer types
- Bot export must be imported from bot/index.js, not root index.js
- Handlers should be imported to register their commands with the bot instance
---

## Thu Feb 19 11:22:14 +08 2026 - US-004
- Created flight input parser with regex patterns for flight numbers
- Implemented date parsing for multiple formats (ISO, slash, month names, relative dates)
- Added support for route detection (airport code + "to" + airport code)
- Created natural language handler that processes text messages
- Bot extracts flight number from free-text messages using pattern matching
- Bot understands relative dates: 'today', 'tomorrow', 'next Monday'
- Bot understands date formats: '2026-03-15', 'March 15', '15/03/2026'
- If flight number found but no date, bot asks for the date
- If no flight number found, bot shows helpful message with examples
- Extracted data follows the same track flow as US-003
- Typecheck passes
- Files changed: src/utils/flight-parser.ts, src/handlers/natural-language.ts, src/bot/index.ts
**Learnings for future iterations:**
- Use bot.on('message:text') to catch all text messages, bot.on('message') catches all message types
- Import handlers to register them - they run on module import, not on explicit call
- Remove generic message handlers when implementing specific ones
---
